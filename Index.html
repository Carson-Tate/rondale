<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DVD Bouncer</title>
<style>
    html, body {
        height: 100%;
        margin: 0;
        background: transparent;
        overflow: hidden;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    canvas {
        display: block;
        width: 100vw;
        height: 100vh;
        background: transparent; 
    }


</style>
</head>
<body>
    <canvas id="stage"></canvas>

<script>


const canvas = document.getElementById('stage');
const ctx = canvas.getContext('2d', { alpha: true });

let DPR = Math.max(1, window.devicePixelRatio || 1);
let W = 0, H = 0;

// sprite state
let logo = new Image();
logo.crossOrigin = "anonymous";
let sprite = {
    x: 100,
    y: 100,
    w: 128,
    h: 64,
    dx: 2.3,
    dy: 1.9,
    speed: 10, // speed
    angle: 0,
    loaded: false
};

function resize() {
    DPR = Math.max(1, window.devicePixelRatio || 1);
    W = Math.floor(window.innerWidth);
    H = Math.floor(window.innerHeight);
    canvas.style.width = W + "px";
    canvas.style.height = H + "px";
    canvas.width = Math.floor(W * DPR);
    canvas.height = Math.floor(H * DPR);
    ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
}
window.addEventListener('resize', resize);

function setLogoSrc(src) {
    sprite.loaded = false;
    logo = new Image();
    logo.onload = () => {
        sprite.w = Math.max(32, logo.width);
        sprite.h = Math.max(32, logo.height);
        const maxDim = Math.min(W, H) * 0.25;
        if (sprite.w > maxDim || sprite.h > maxDim) {
            const s = maxDim / Math.max(sprite.w, sprite.h);
            sprite.w = Math.round(sprite.w * s);
            sprite.h = Math.round(sprite.h * s);
        }
        sprite.x = Math.max(0, Math.min(sprite.x, W - sprite.w));
        sprite.y = Math.max(0, Math.min(sprite.y, H - sprite.h));
        sprite.loaded = true;
    };
    logo.src = src;
}

function reset() {
    sprite.x = Math.random() * (W - sprite.w || 1);
    sprite.y = Math.random() * (H - sprite.h || 1);
    let angle;
    do {
        angle = Math.random() * Math.PI * 2;
    } while (Math.abs(Math.cos(angle)) < 0.3 || Math.abs(Math.sin(angle)) < 0.3);
    sprite.dx = Math.cos(angle) * sprite.speed;
    sprite.dy = Math.sin(angle) * sprite.speed;
}

function update() {
    if (!sprite.loaded) return;
    sprite.x += sprite.dx;
    sprite.y += sprite.dy;

    let bounced = false;
    if (sprite.x <= 0) { sprite.x = 0; sprite.dx = Math.abs(sprite.dx); bounced = true; }
    if (sprite.x + sprite.w >= W) { sprite.x = W - sprite.w; sprite.dx = -Math.abs(sprite.dx); bounced = true; }
    if (sprite.y <= 0) { sprite.y = 0; sprite.dy = Math.abs(sprite.dy); bounced = true; }
    if (sprite.y + sprite.h >= H) { sprite.y = H - sprite.h; sprite.dy = -Math.abs(sprite.dy); bounced = true; }

    if (bounced) {
        let ang = Math.atan2(sprite.dy, sprite.dx);
        
        ang += (Math.random() - 0.5) * Math.PI / 6; // up to Â±30 degrees
        
        const cosAng = Math.cos(ang);
        const sinAng = Math.sin(ang);
        if (Math.abs(cosAng) < 0.3) {
            ang += (cosAng > 0 ? 1 : -1) * Math.PI / 6;
        }
        if (Math.abs(sinAng) < 0.3) {
            ang += (sinAng > 0 ? 1 : -1) * Math.PI / 6;
        }
        
        sprite.dx = Math.cos(ang) * sprite.speed;
        sprite.dy = Math.sin(ang) * sprite.speed;
    }
}

function draw() {
    ctx.clearRect(0, 0, W, H);

    if (sprite.loaded) {
        ctx.drawImage(logo, sprite.x, sprite.y, sprite.w, sprite.h);
    }
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

logo.addEventListener('load', reset);

resize();
setLogoSrc('rondale.png');
loop();
</script>
</body>

</html>

